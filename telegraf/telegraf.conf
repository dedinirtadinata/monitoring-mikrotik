[agent]
  interval = "5s"
  round_interval = true
  skip_processors_after_aggregators = true

[[outputs.influxdb]]
  urls = ["http://influxdb:8086"]
  database = "mikrotik"
  username = "telegraf"
  password = "telegraf123"

# --- INPUT 1: SYSTEM RESOURCES ---
[[inputs.snmp]]
  name_override = "snmp_system"
  agents = ["10.6.86.1"]
  agent_host_tag = "source"
  community = "monitoring"
  version = 2
  interval = "5s"
  timeout = "10s"
  retries = 3

  [inputs.snmp.tags]
    device  = "mikrotik-hotspot"
    lokasi  = "ruang-bidang"
    vendor  = "mikrotik"

  # Hostname
  [[inputs.snmp.field]]
    name = "hostname"
    oid  = "1.3.6.1.2.1.1.5.0"
    is_tag = true

  # Uptime
  [[inputs.snmp.field]]
    name = "uptime"
    oid  = "1.3.6.1.2.1.1.3.0"

  # CPU load (Core 1)
  [[inputs.snmp.field]]
    name = "cpu_load"
    oid  = "1.3.6.1.2.1.25.3.3.1.2.1"

  # Memory (RAM) - using hrStorage (Index 65536 usually RAM)
  [[inputs.snmp.field]]
    name = "ram_used"
    oid  = "1.3.6.1.2.1.25.2.3.1.6.65536"

  [[inputs.snmp.field]]
    name = "ram_total"
    oid  = "1.3.6.1.2.1.25.2.3.1.5.65536"

  # Temperature (System Health Table)
  [[inputs.snmp.field]]
    name = "temperature"
    oid  = "1.3.6.1.4.1.14988.1.1.3.100.1.3.14"

  # Voltage (System Health Table)
  [[inputs.snmp.field]]
    name = "voltage"
    oid  = "1.3.6.1.4.1.14988.1.1.3.100.1.3.13"

  # Active DHCP Leases (Clients)
  [[inputs.snmp.field]]
    name = "active_dhcp_leases"
    oid  = "1.3.6.1.4.1.14988.1.1.6.1.0"

# --- INPUT 2: INTERFACES ---
[[inputs.snmp]]
  agents = ["10.6.86.1"]
  agent_host_tag = "source"
  community = "monitoring"
  version = 2
  interval = "5s"
  timeout = "10s"
  retries = 3
  
  [[inputs.snmp.table]]
    name = "snmp_interface"
    
    [[inputs.snmp.table.field]]
      name = "ifName"
      oid  = "1.3.6.1.2.1.31.1.1.1.1"
      is_tag = true

    [[inputs.snmp.table.field]]
      name = "ifHCInOctets"
      oid  = "1.3.6.1.2.1.31.1.1.1.6"

    [[inputs.snmp.table.field]]
      name = "ifHCOutOctets"
      oid  = "1.3.6.1.2.1.31.1.1.1.10"

    [[inputs.snmp.table.field]]
      name = "ifInErrors"
      oid  = "1.3.6.1.2.1.2.2.1.14"

    [[inputs.snmp.table.field]]
      name = "ifOutErrors"
      oid  = "1.3.6.1.2.1.2.2.1.20"

    [[inputs.snmp.table.field]]
      name = "ifOperStatus"
      oid  = "1.3.6.1.2.1.2.2.1.8"

    # Interface Comment (Alias)
    [[inputs.snmp.table.field]]
      name = "ifAlias"
      oid  = "1.3.6.1.2.1.31.1.1.1.18"
      is_tag = true

# --- INPUT 3: QUEUE TREE ---
[[inputs.snmp]]
  agents = ["10.6.86.1"]
  agent_host_tag = "source"
  community = "monitoring"
  version = 2
  interval = "5s"
  timeout = "10s"
  retries = 3

  [[inputs.snmp.table]]
    name = "mikrotik_queue_tree"

    [[inputs.snmp.table.field]]
      name = "name"
      oid  = "1.3.6.1.4.1.14988.1.1.2.2.1.2"
      is_tag = true

    [[inputs.snmp.table.field]]
      name = "inner_bytes"
      oid  = "1.3.6.1.4.1.14988.1.1.2.2.1.7"

    [[inputs.snmp.table.field]]
      name = "inner_packets"
      oid  = "1.3.6.1.4.1.14988.1.1.2.2.1.6"

[[inputs.ping]]
  urls = ["10.6.86.1"]
  count = 3
  interval = "5s"
  timeout = 2.0
